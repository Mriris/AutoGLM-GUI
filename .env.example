# AutoGLM-GUI Configuration Example
# Copy this file to .env and fill in your values
# 配置优先级：CLI 参数 > 环境变量 > 配置文件 (~/.config/autoglm/config.json) > 默认值

# ============================================
# Model API Configuration (模型 API 配置)
# ============================================
# 选择你的 API 提供商（以下任选其一）：

# 选项 1: ModelScope (推荐，国内访问快)
MODEL_BASE_URL=https://api-inference.modelscope.cn/v1
MODEL_NAME=ZhipuAI/AutoGLM-Phone-9B
MODEL_API_KEY=ms-your-api-key-here

# 选项 2: 智谱 AI 官方 API
# MODEL_BASE_URL=https://open.bigmodel.cn/api/paas/v4
# MODEL_NAME=autoglm-phone
# MODEL_API_KEY=sk-your-zhipu-api-key-here

# 选项 3: 本地 vLLM 服务
# MODEL_BASE_URL=http://localhost:8000/v1
# MODEL_NAME=zai-org/AutoGLM-Phone-9B
# MODEL_API_KEY=EMPTY

# ============================================
# Model Sampling Parameters (模型采样参数 - 防止重复输出)
# ============================================
# Temperature: 控制输出随机性 (0.0=确定性, 1.0=高随机性)
# 推荐值：0.7 (平衡稳定性和多样性)
MODEL_TEMPERATURE=0.7

# Top-P: 核采样阈值 (0.0-1.0)
# 推荐值：0.85 (保留 85% 的概率质量)
MODEL_TOP_P=0.85

# Frequency Penalty: 频率惩罚，根据已出现次数惩罚重复 (0.0-2.0)
# 推荐值：0.5 (适度惩罚重复)
MODEL_FREQUENCY_PENALTY=0.5

# Repetition Penalty: 重复惩罚，直接降低已出现token的概率 (1.0=无惩罚, >1.0=惩罚重复)
# 推荐值：1.1 (轻度惩罚，防止重复输出)
# 如果仍有重复，可调高到 1.15-1.2
MODEL_REPETITION_PENALTY=1.1

# Max Tokens: 最大输出长度
# 推荐值：3000 (足够长的上下文)
MODEL_MAX_TOKENS=3000

# ============================================
# Agent Configuration (智能体配置)
# ============================================
# 注意: DEVICE_TYPE 和 DEVICE_ID 由前端在连接设备时自动识别和设置，无需在此配置
# Language: cn (中文) 或 en (English)
AGENT_LANG=cn

# Max Steps: 单次任务最大执行步数 (防止无限循环)
# 推荐值：100 (足够完成大多数任务)
AGENT_MAX_STEPS=100

# Verbose: 详细输出模式 (true/false)
# true: 输出详细执行日志
# false: 仅输出关键信息
AGENT_VERBOSE=true

# System Prompt: 自定义系统提示词 (可选，留空使用默认)
# 高级用户可以自定义 Agent 的行为指令
# AGENT_SYSTEM_PROMPT=你是一个手机操作助手...

# ============================================
# Timing Configuration (执行延迟配置 - 单位：秒)
# ============================================
# 设备操作延迟：每个动作执行后的等待时间
# 默认值：1.0 秒（适合大多数设备）
# 如果设备响应快，可以降低到 0.5；如果设备慢或网络延迟高，可以提高到 1.5-2.0

# 基础操作延迟
PHONE_AGENT_TAP_DELAY=1.0              # 点击后延迟
PHONE_AGENT_DOUBLE_TAP_DELAY=1.0       # 双击后延迟
PHONE_AGENT_DOUBLE_TAP_INTERVAL=0.1    # 双击间隔时间
PHONE_AGENT_LONG_PRESS_DELAY=1.0       # 长按后延迟
PHONE_AGENT_SWIPE_DELAY=1.0            # 滑动后延迟
PHONE_AGENT_BACK_DELAY=1.0             # 返回键后延迟
PHONE_AGENT_HOME_DELAY=1.0             # Home 键后延迟
PHONE_AGENT_LAUNCH_DELAY=1.0           # 启动应用后延迟

# 文本输入延迟
PHONE_AGENT_KEYBOARD_SWITCH_DELAY=1.0  # 切换键盘后延迟
PHONE_AGENT_TEXT_CLEAR_DELAY=1.0       # 清空文本后延迟
PHONE_AGENT_TEXT_INPUT_DELAY=1.0       # 输入文本后延迟
PHONE_AGENT_KEYBOARD_RESTORE_DELAY=1.0 # 恢复键盘后延迟

# 连接延迟
PHONE_AGENT_ADB_RESTART_DELAY=2.0      # ADB 重启后延迟
PHONE_AGENT_SERVER_RESTART_DELAY=1.0   # 服务器重启后延迟

# ============================================
# 使用示例
# ============================================
# 1. 复制此文件：cp .env.example .env
# 2. 填写你的 API 配置 (MODEL_BASE_URL, MODEL_NAME, MODEL_API_KEY)
# 3. 运行：uv run autoglm-gui
# 4. 在前端界面中连接设备（自动识别设备类型和 ID）
# 5. 如需覆盖配置，使用 CLI 参数：
#    uv run autoglm-gui --base-url http://localhost:8000/v1 --model your-model

# ============================================
# 故障排查
# ============================================
# 问题 1: 模型重复输出相同内容
# 解决：调高 MODEL_REPETITION_PENALTY (1.1 -> 1.15 -> 1.2)
#      调高 MODEL_FREQUENCY_PENALTY (0.5 -> 0.7)
#      调高 MODEL_TEMPERATURE (0.7 -> 0.8)

# 问题 2: 模型输出不稳定/随机
# 解决：降低 MODEL_TEMPERATURE (0.7 -> 0.5 -> 0.3)

# 问题 3: 模型输出太短
# 解决：降低 MODEL_REPETITION_PENALTY (1.1 -> 1.05)
#      增加 MODEL_MAX_TOKENS (3000 -> 4096)

# 问题 4: 操作执行太快，设备响应不过来
# 解决：增加延迟时间 PHONE_AGENT_TAP_DELAY (1.0 -> 1.5 -> 2.0)
#      或统一增加所有 PHONE_AGENT_*_DELAY 参数

# 问题 5: 操作执行太慢，效率低
# 解决：减少延迟时间 PHONE_AGENT_TAP_DELAY (1.0 -> 0.5)
#      注意：延迟太短可能导致操作失败

# 问题 6: WiFi 连接不稳定，操作经常失败
# 解决：增加所有延迟参数到 1.5-2.0 秒
#      检查网络延迟和稳定性

# 问题 7: ADB Keyboard 安装失败
# 解决：手动安装 https://github.com/senzhk/ADBKeyBoard/releases
#      或检查设备是否允许第三方输入法
